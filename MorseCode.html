<!DOCTYPE html>
<html>
<head>

	<title>Morse Code practice</title>

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	
	<style>
	
	
	.codeKey{
		
		width: 76px;
		height: 76px;
		border-radius: 100%;
		background-color: red;
		
		border: 3px solid black;
		
		color: white;
		text-align: center;
		padding: 0,30,0,30;
		font-size: 36;
		font-weight: bold;
		
	}
	
	.bigTxt{
		font-size: 40px;
		font-weight: bold;
	}
	
	</style>

</head>
<body>

<pre id="morse_code" class="jumbotron bigTxt"></pre>

<div id="translation" class="panel panel-default"></div>

<hr>

<div id="codeKey" class="btn codeKey">Code Key</div>

<div id="clear" class="btn btn-default ">Clear</div>


<script>

let start, end, spaces;
var code_out = "", chars_out = "";

toLetters = () => {
	let co = code_out.replace("-", "s")
	let c = co.replace(".", "d");
	let codes = c.split(" ");
	
	let alphaDict = {
		"ds":"a",
		"sddd":"b",
		"sds":"c",
		"ssd":"d",
		"d":"e",
		"ddsd":"f",
		"ssd":"g",
		"dddd":"h",
		"dd":"i",
		"dsss":"j",
		"sds":"k",
		"dsdd":"l",
		"ss":"m",
		"sd":"n",
		"sss":"o",
		"dssd":"p",
		"ssds":"q",
		"dsd":"r",
		"ddd":"s",
		"s":"t",
		"dds":"u",
		"ddds":"v",
		"dss":"w",
		"sdds":"x",
		"sdss":"y",
		"ssdd":"z",
		"-----":"0",
		".----":"1",
		"..---":"2",
		"...--":"3",
		"....-":"4",
		".....":"5",
		"-....":"6",
		"--...":"7",
		"---..":"8",
		"----.":"9"
		
	};
	
	chars_out = "";  //Reset chars_out so it does not repeat items
	codes.forEach( cur => {
		chars_out += alphaDict[ cur ];
	});
	
	$("#translation").text(chars_out);
}

sec = () => {
	let t = new Date();
	
	return t.getTime();
	
}

//Compare a and b, and output a "." or a "-"
compare = (a,b, m) => {

	let n = new Date();
	let lastT = n.getTime() - end;
	
	if (m === 1 && lastT > 1000 ){
		return "     ";
	} else if (m === 1 && lastT > 400){
		return  " ";
	}else if (m === 1){
		return "";
	}
	
	let tst = b - a;
	
	if (tst > 250){
		return "-";
	} 
	
	return ".";
	
}



$("#codeKey").mousedown( () => {
	start = sec();
	
	//code_out += compare(start, end, 1);
	
	//toLetters();
});

$("#codeKey").mouseup( () => {
	end = sec();
	
	code_out += compare(start, end, 0);
	$("#morse_code").text(code_out);
	
	toLetters();
	
});

$("#clear").click( () => {
	$("#morse_code").text("");
	$("#translation").text("");
	code_out = "";
	chars_out = "";
});





	
</script>

</body>
</html>